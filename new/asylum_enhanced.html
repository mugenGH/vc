<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOLLOW CREEK ASYLUM - [REC]</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&family=Courier+Prime:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', monospace;
            background: #000;
            color: #0f0;
            min-height: 100vh;
            overflow-x: hidden;
            cursor: crosshair;
            transition: filter 0.5s ease;
        }

        body.low-sanity {
            filter: hue-rotate(20deg) saturate(1.5);
        }

        body.critical-sanity {
            filter: hue-rotate(40deg) saturate(2) blur(0.5px);
            animation: sanityPulse 2s infinite;
        }

        @keyframes sanityPulse {
            0%, 100% { filter: hue-rotate(40deg) saturate(2) blur(0.5px); }
            50% { filter: hue-rotate(60deg) saturate(2.5) blur(1px); }
        }

        /* Camera HUD */
        .hud {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            font-family: 'VT323', monospace;
        }

        .hud-top {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            color: #0f0;
            font-size: 1.2em;
            text-shadow: 0 0 10px #0f0;
        }

        .recording {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rec-dot {
            width: 12px;
            height: 12px;
            background: #f00;
            border-radius: 50%;
            animation: blink 1s infinite;
            box-shadow: 0 0 10px #f00;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .battery, .sanity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .battery-bar, .sanity-bar {
            width: 100px;
            height: 20px;
            border: 2px solid #0f0;
            position: relative;
            box-shadow: 0 0 10px #0f0;
            overflow: hidden;
        }

        .battery-fill, .sanity-fill {
            height: 100%;
            background: #0f0;
            transition: width 0.5s ease, background 0.3s ease;
            box-shadow: 0 0 10px #0f0;
        }

        .battery-fill.low, .sanity-fill.low {
            background: #ff0;
            animation: batteryWarning 0.5s infinite;
        }

        .battery-fill.critical, .sanity-fill.critical {
            background: #f00;
            animation: batteryWarning 0.3s infinite;
        }

        @keyframes batteryWarning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .timestamp {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 1.2em;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }

        /* Audio Controls */
        .audio-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1001;
            pointer-events: auto;
        }

        .audio-btn {
            background: rgba(0, 30, 0, 0.8);
            border: 2px solid #0f0;
            color: #0f0;
            padding: 8px 12px;
            font-family: 'VT323', monospace;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .audio-btn:hover {
            background: rgba(0, 60, 0, 0.9);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }

        .audio-btn.muted {
            border-color: #f00;
            color: #f00;
        }

        /* Camera Effects */
        .camera-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .camera-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 20%, rgba(0, 0, 0, 0.85) 100%);
        }

        .camera-overlay::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 255, 0, 0.02) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 255, 0, 0.02) 3px
            );
            animation: scanlines 0.1s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(3px); }
        }

        .grain {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            pointer-events: none;
            z-index: 998;
            opacity: 0.08;
            background: repeating-radial-gradient(circle, transparent 0, rgba(0, 255, 0, 0.3) 2px, transparent 3px);
            animation: grain 0.2s steps(10) infinite;
        }

        @keyframes grain {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -5%); }
            20% { transform: translate(-10%, 5%); }
            30% { transform: translate(5%, -10%); }
            40% { transform: translate(-5%, 15%); }
            50% { transform: translate(-15%, 5%); }
            60% { transform: translate(15%, 0%); }
            70% { transform: translate(0%, 15%); }
            80% { transform: translate(-10%, 10%); }
            90% { transform: translate(10%, 5%); }
        }

        /* Game Container */
        .game-container {
            position: relative;
            z-index: 2;
            max-width: 960px;
            width: 95%;
            margin: 50px auto;
            padding: 30px;
            background: rgba(0, 15, 0, 0.85);
            border: 2px solid #0f0;
            box-shadow: 
                0 0 40px rgba(0, 255, 0, 0.4),
                inset 0 0 40px rgba(0, 0, 0, 0.9);
            opacity: 0;
            transform: translateY(20px);
            animation: containerFadeIn 1s ease forwards;
        }

        @keyframes containerFadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Title */
        .title {
            text-align: center;
            margin-bottom: 20px;
        }

        .title h1 {
            font-family: 'Share Tech Mono', monospace;
            font-size: 2.8em;
            color: #0f0;
            text-shadow: 0 0 25px #0f0, 0 0 50px rgba(0, 255, 0, 0.5);
            letter-spacing: 4px;
            animation: titleFlicker 4s infinite;
        }

        @keyframes titleFlicker {
            0%, 100% { opacity: 1; text-shadow: 0 0 25px #0f0; }
            41%, 43% { opacity: 0.85; text-shadow: 0 0 15px #0f0; }
            44%, 46% { opacity: 0.95; text-shadow: 0 0 20px #0f0; }
            48% { opacity: 0.9; }
        }

        .subtitle {
            font-family: 'VT323', monospace;
            font-size: 1.2em;
            color: #0a0;
            margin-top: 8px;
            letter-spacing: 2px;
        }

        /* Location */
        .location {
            text-align: center;
            padding: 14px 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0f0;
            margin-bottom: 20px;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 3px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.25);
            transition: all 0.5s ease;
        }

        .location.danger {
            border-color: #f00;
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.4);
            color: #f00;
        }

        /* Characters */
        .character-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .character {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            padding: 14px;
            text-align: center;
            position: relative;
            transition: all 0.4s ease;
            overflow: hidden;
        }

        .character::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.08), transparent);
            animation: characterSweep 3s infinite;
        }

        @keyframes characterSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .character.dead {
            opacity: 0.25;
            border-color: #f00;
            filter: grayscale(1);
        }

        .character.dead::after {
            content: '[DECEASED]';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #f00;
            font-weight: bold;
            font-size: 1.1em;
            text-shadow: 0 0 10px #f00;
        }

        .character-icon {
            font-size: 2.6em;
            display: block;
            margin-bottom: 8px;
            filter: drop-shadow(0 0 8px #0f0);
        }

        .character-name {
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 4px;
        }

        .character-state {
            font-size: 0.85em;
            color: #0a0;
            font-style: italic;
        }

        /* Story Section */
        .story-section {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            padding: 24px;
            margin-bottom: 20px;
            min-height: 280px;
            position: relative;
            box-shadow: inset 0 0 30px rgba(0, 255, 0, 0.08);
        }

        .story-text {
            font-size: 1.1em;
            line-height: 1.85;
            color: #0f0;
            text-shadow: 0 0 4px #0f0;
            margin-bottom: 16px;
        }

        .story-text .typewriter-cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background: #0f0;
            margin-left: 2px;
            animation: cursorBlink 0.8s infinite;
            vertical-align: text-bottom;
        }

        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Document */
        .document {
            background: rgba(0, 40, 0, 0.5);
            border-left: 4px solid #0f0;
            padding: 14px;
            margin: 18px 0;
            font-family: 'Courier Prime', monospace;
            font-style: italic;
            color: #0f0;
            box-shadow: 0 0 12px rgba(0, 255, 0, 0.25);
            animation: documentSlide 0.5s ease;
        }

        @keyframes documentSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .document::before {
            content: 'ðŸ“„ DOCUMENT FOUND';
            display: block;
            font-weight: bold;
            font-style: normal;
            margin-bottom: 8px;
            color: #0ff;
            text-shadow: 0 0 8px #0ff;
        }

        /* Warning */
        .warning {
            background: rgba(80, 0, 0, 0.6);
            border: 2px solid #f00;
            padding: 14px;
            margin: 18px 0;
            color: #f00;
            text-align: center;
            font-weight: bold;
            animation: warningPulse 1.2s infinite;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 20px rgba(255, 0, 0, 0.4); }
            50% { opacity: 0.7; box-shadow: 0 0 30px rgba(255, 0, 0, 0.6); }
        }

        .warning::before {
            content: 'âš ï¸ ';
            font-size: 1.3em;
        }

        /* Choices */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .choice {
            background: rgba(0, 40, 0, 0.7);
            border: 2px solid #0f0;
            padding: 16px 22px;
            font-size: 1.05em;
            font-family: 'Courier Prime', monospace;
            color: #0f0;
            text-align: left;
            cursor: pointer;
            position: relative;
            transition: all 0.25s ease;
            text-shadow: 0 0 4px #0f0;
            opacity: 0;
            transform: translateX(-15px);
            animation: choiceFadeIn 0.4s ease forwards;
        }

        .choice:nth-child(1) { animation-delay: 0.1s; }
        .choice:nth-child(2) { animation-delay: 0.2s; }
        .choice:nth-child(3) { animation-delay: 0.3s; }
        .choice:nth-child(4) { animation-delay: 0.4s; }

        @keyframes choiceFadeIn {
            to { opacity: 1; transform: translateX(0); }
        }

        .choice::before {
            content: '> ';
            color: #0f0;
            font-weight: bold;
        }

        .choice:hover {
            background: rgba(0, 80, 0, 0.9);
            transform: translateX(8px);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.45);
        }

        .choice.dangerous {
            border-color: #ff0;
            color: #ff0;
            text-shadow: 0 0 4px #ff0;
        }

        .choice.dangerous:hover {
            background: rgba(80, 80, 0, 0.9);
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.45);
        }

        .choice.critical {
            border-color: #f00;
            color: #f00;
            text-shadow: 0 0 4px #f00;
            animation: choiceFadeIn 0.4s ease forwards, criticalPulse 1.5s infinite;
        }

        .choice.critical:hover {
            background: rgba(80, 0, 0, 0.9);
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.5);
        }

        @keyframes criticalPulse {
            0%, 100% { box-shadow: 0 0 8px rgba(255, 0, 0, 0.4); }
            50% { box-shadow: 0 0 20px rgba(255, 0, 0, 0.7); }
        }

        .choice.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: #444;
            color: #444;
        }

        .choice.disabled:hover {
            transform: none;
            background: rgba(0, 40, 0, 0.7);
            box-shadow: none;
        }

        .restart {
            background: rgba(0, 0, 80, 0.7);
            border-color: #0ff;
            color: #0ff;
        }

        .restart:hover {
            background: rgba(0, 0, 120, 0.9);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.45);
        }

        /* Screen Effects */
        .static-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.1);
            animation: staticAnim 0.08s infinite;
            display: none;
        }

        .static-effect.active {
            display: block;
        }

        @keyframes staticAnim {
            0% { opacity: 0.08; }
            50% { opacity: 0.15; }
            100% { opacity: 0.08; }
        }

        .blood-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            background: radial-gradient(circle, transparent 35%, rgba(255, 0, 0, 0.5) 100%);
            display: none;
            animation: bloodPulse 0.6s ease-out;
        }

        .blood-effect.active {
            display: block;
        }

        @keyframes bloodPulse {
            0% { opacity: 0; }
            30% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Inventory */
        .inventory {
            display: flex;
            gap: 8px;
            margin-bottom: 18px;
            padding: 14px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0;
            flex-wrap: wrap;
        }

        .inventory-label {
            color: #0f0;
            font-weight: bold;
            width: 100%;
            margin-bottom: 6px;
        }

        .item {
            background: rgba(0, 40, 0, 0.7);
            border: 1px solid #0f0;
            padding: 6px 12px;
            font-size: 0.85em;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.25);
            animation: itemPop 0.3s ease;
        }

        @keyframes itemPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #0f0;
        }

        .loading-text {
            font-size: 1.8em;
            font-family: 'VT323', monospace;
            margin-bottom: 25px;
            text-shadow: 0 0 20px #0f0;
            letter-spacing: 2px;
        }

        .loading-bar {
            width: 280px;
            height: 26px;
            border: 2px solid #0f0;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
        }

        .loading-fill {
            height: 100%;
            background: #0f0;
            width: 0%;
            animation: loading 2.5s ease-in-out forwards;
            box-shadow: 0 0 15px #0f0;
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        .loading-info {
            margin-top: 25px;
            font-family: 'VT323', monospace;
            font-size: 1.1em;
            text-align: center;
            line-height: 1.8;
            color: #0a0;
        }

        .hidden {
            display: none !important;
        }

        /* Scene Transition */
        .scene-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 5000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .scene-transition.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-container {
                padding: 18px;
                margin: 30px auto;
            }

            .title h1 {
                font-size: 1.8em;
            }

            .hud-top {
                flex-direction: column;
                gap: 8px;
                font-size: 1em;
            }

            .battery-bar, .sanity-bar {
                width: 70px;
            }

            .audio-controls {
                bottom: 10px;
                right: 10px;
            }

            .audio-btn {
                padding: 6px 10px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-text">INITIALIZING NIGHT VISION...</div>
        <div class="loading-bar">
            <div class="loading-fill"></div>
        </div>
        <div class="loading-info">
            HOLLOW CREEK PSYCHIATRIC FACILITY<br>
            INVESTIGATION: SUBJECT 47<br>
            [CONFIDENTIAL]
        </div>
    </div>

    <!-- Scene Transition -->
    <div class="scene-transition" id="sceneTransition"></div>

    <!-- Camera HUD -->
    <div class="hud">
        <div class="hud-top">
            <div class="recording">
                <div class="rec-dot"></div>
                <span>REC</span>
            </div>
            <div class="battery">
                <span>BATTERY:</span>
                <div class="battery-bar">
                    <div class="battery-fill" id="batteryFill" style="width: 100%"></div>
                </div>
                <span id="batteryPercent">100%</span>
            </div>
            <div class="sanity">
                <span>SANITY:</span>
                <div class="sanity-bar">
                    <div class="sanity-fill" id="sanityFill" style="width: 100%"></div>
                </div>
                <span id="sanityPercent">100%</span>
            </div>
        </div>
        <div class="timestamp" id="timestamp">00:00:00</div>
    </div>

    <!-- Audio Controls -->
    <div class="audio-controls">
        <button class="audio-btn" id="toggleMusic" title="Toggle Music">ðŸŽµ Music</button>
        <button class="audio-btn" id="toggleSFX" title="Toggle Sound Effects">ðŸ”Š SFX</button>
    </div>

    <!-- Camera Effects -->
    <div class="camera-overlay"></div>
    <div class="grain"></div>
    <div class="static-effect" id="staticEffect"></div>
    <div class="blood-effect" id="bloodEffect"></div>

    <!-- Game Container -->
    <div class="game-container">
        <div class="title">
            <h1>HOLLOW CREEK ASYLUM</h1>
            <div class="subtitle">[NIGHT VISION ACTIVE]</div>
        </div>

        <div class="location" id="location">LOCATION: MAIN GATE</div>

        <div class="inventory hidden" id="inventory">
            <div class="inventory-label">ðŸ“¦ INVENTORY:</div>
        </div>

        <div class="character-status" id="characters">
            <div class="character" id="char-you">
                <div class="character-icon">ðŸ“¹</div>
                <div class="character-name">YOU</div>
                <div class="character-state">Investigator</div>
            </div>
        </div>

        <div class="story-section">
            <div class="story-text" id="storyText"></div>
        </div>

        <div class="choices" id="choices"></div>
    </div>

    <script>
        // ============== AUDIO SYSTEM ==============
        const AudioManager = {
            bgMusic: null,
            suddenMusic: null,
            dialogueAudio: null,
            musicEnabled: true,
            sfxEnabled: true,
            currentBgTrack: 'normal',
            audioContext: null,
            
            init() {
                // Create audio context for better control
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Background music (normal ambience)
                this.bgMusic = new Audio();
                this.bgMusic.loop = true;
                this.bgMusic.volume = 0.3;
                this.bgMusic.src = 'assets/audio/background/normal.mp3';
                this.bgMusic.onerror = () => {
                    console.log('Background music file not found, continuing without audio');
                };
                
                // Sudden/intense music
                this.suddenMusic = new Audio();
                this.suddenMusic.loop = true;
                this.suddenMusic.volume = 0;
                this.suddenMusic.src = 'assets/audio/background/sudden.mp3';
                this.suddenMusic.onerror = () => {
                    console.log('Sudden music file not found, continuing without audio');
                };
                
                // Dialogue sounds
                this.dialogueAudio = new Audio();
                this.dialogueAudio.volume = 0.5;
                this.dialogueAudio.src = 'assets/audio/dialogue/speak.mp3';
                this.dialogueAudio.onerror = () => {
                    console.log('Dialogue audio file not found, continuing without audio');
                };
                
                // Setup controls
                document.getElementById('toggleMusic').addEventListener('click', () => this.toggleMusic());
                document.getElementById('toggleSFX').addEventListener('click', () => this.toggleSFX());
            },
            
            playBgMusic() {
                if (!this.musicEnabled) return;
                this.bgMusic.play().catch(() => {
                    console.log('Could not play background music - file may be missing');
                });
            },
            
            stopBgMusic() {
                this.bgMusic.pause();
                this.suddenMusic.pause();
            },
            
            // Crossfade to sudden/tense music
            switchToSudden(duration = 1500) {
                if (!this.musicEnabled || this.currentBgTrack === 'sudden') return;
                this.currentBgTrack = 'sudden';
                
                this.suddenMusic.currentTime = this.bgMusic.currentTime % this.suddenMusic.duration || 0;
                this.suddenMusic.play().catch(() => {
                    console.log('Could not play sudden music');
                });
                
                const fadeStep = 50;
                const steps = duration / fadeStep;
                const bgDecrement = this.bgMusic.volume / steps;
                const suddenIncrement = 0.4 / steps;
                
                const fadeInterval = setInterval(() => {
                    if (this.bgMusic.volume > 0.01) {
                        this.bgMusic.volume = Math.max(0, this.bgMusic.volume - bgDecrement);
                    }
                    if (this.suddenMusic.volume < 0.4) {
                        this.suddenMusic.volume = Math.min(0.4, this.suddenMusic.volume + suddenIncrement);
                    }
                    if (this.bgMusic.volume <= 0.01 && this.suddenMusic.volume >= 0.39) {
                        clearInterval(fadeInterval);
                        this.bgMusic.pause();
                    }
                }, fadeStep);
            },
            
            // Crossfade back to normal music
            switchToNormal(duration = 2000) {
                if (!this.musicEnabled || this.currentBgTrack === 'normal') return;
                this.currentBgTrack = 'normal';
                
                this.bgMusic.play().catch(() => {});
                
                const fadeStep = 50;
                const steps = duration / fadeStep;
                const bgIncrement = 0.3 / steps;
                const suddenDecrement = this.suddenMusic.volume / steps;
                
                const fadeInterval = setInterval(() => {
                    if (this.suddenMusic.volume > 0.01) {
                        this.suddenMusic.volume = Math.max(0, this.suddenMusic.volume - suddenDecrement);
                    }
                    if (this.bgMusic.volume < 0.3) {
                        this.bgMusic.volume = Math.min(0.3, this.bgMusic.volume + bgIncrement);
                    }
                    if (this.suddenMusic.volume <= 0.01 && this.bgMusic.volume >= 0.29) {
                        clearInterval(fadeInterval);
                        this.suddenMusic.pause();
                    }
                }, fadeStep);
            },
            
            playDialogueSound() {
                if (!this.sfxEnabled) return;
                this.dialogueAudio.currentTime = 0;
                this.dialogueAudio.play().catch(() => {
                    // Silent fail if audio not available
                });
            },
            
            // Play a one-shot sound effect
            playSFX(type) {
                if (!this.sfxEnabled) return;
                
                const sfx = new Audio();
                sfx.volume = 0.5;
                
                switch(type) {
                    case 'footsteps':
                        sfx.src = 'assets/audio/sfx/footsteps.mp3';
                        break;
                    case 'door':
                        sfx.src = 'assets/audio/sfx/door.mp3';
                        break;
                    case 'scream':
                        sfx.src = 'assets/audio/sfx/scream.mp3';
                        break;
                    case 'heartbeat':
                        sfx.src = 'assets/audio/sfx/heartbeat.mp3';
                        break;
                }
                
                sfx.play().catch(() => {});
            },
            
            toggleMusic() {
                this.musicEnabled = !this.musicEnabled;
                const btn = document.getElementById('toggleMusic');
                
                if (this.musicEnabled) {
                    btn.classList.remove('muted');
                    btn.textContent = 'ðŸŽµ Music';
                    this.playBgMusic();
                } else {
                    btn.classList.add('muted');
                    btn.textContent = 'ðŸ”‡ Music';
                    this.stopBgMusic();
                }
            },
            
            toggleSFX() {
                this.sfxEnabled = !this.sfxEnabled;
                const btn = document.getElementById('toggleSFX');
                
                if (this.sfxEnabled) {
                    btn.classList.remove('muted');
                    btn.textContent = 'ðŸ”Š SFX';
                } else {
                    btn.classList.add('muted');
                    btn.textContent = 'ðŸ”‡ SFX';
                }
            }
        };

        // ============== GAME STATE ==============
        const gameState = {
            scene: 0,
            battery: 100,
            sanity: 100,
            inventory: [],
            companions: {
                grimlock: false,
                whiskers: false,
                mortis: false
            },
            batteryDrainRate: 0.25,
            time: 0,
            isTyping: false
        };

        // Intervals
        let batteryInterval;
        let timeInterval;

        // ============== TYPEWRITER EFFECT ==============
        async function typeWriter(element, text, speed = 25) {
            gameState.isTyping = true;
            element.innerHTML = '';
            
            // Parse HTML to preserve tags
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            
            const processNode = async (node, targetElement) => {
                if (node.nodeType === Node.TEXT_NODE) {
                    for (let char of node.textContent) {
                        if (!gameState.isTyping) {
                            targetElement.textContent += node.textContent.slice(node.textContent.indexOf(char));
                            return;
                        }
                        targetElement.textContent += char;
                        
                        // Play dialogue sound periodically
                        if (Math.random() < 0.1) {
                            AudioManager.playDialogueSound();
                        }
                        
                        await new Promise(r => setTimeout(r, speed));
                    }
                } else if (node.nodeType === Node.ELEMENT_NODE) {
                    const newElement = document.createElement(node.tagName);
                    for (let attr of node.attributes) {
                        newElement.setAttribute(attr.name, attr.value);
                    }
                    targetElement.appendChild(newElement);
                    
                    for (let child of node.childNodes) {
                        await processNode(child, newElement);
                    }
                }
            };
            
            for (let child of tempDiv.childNodes) {
                await processNode(child, element);
            }
            
            gameState.isTyping = false;
        }

        function skipTypewriter() {
            gameState.isTyping = false;
        }

        // ============== UI UPDATES ==============
        function updateBattery() {
            const fill = document.getElementById('batteryFill');
            const percent = document.getElementById('batteryPercent');
            fill.style.width = gameState.battery + '%';
            percent.textContent = Math.floor(gameState.battery) + '%';
            
            fill.className = 'battery-fill';
            if (gameState.battery < 30) fill.classList.add('low');
            if (gameState.battery < 10) fill.classList.add('critical');
        }

        function updateSanity() {
            const fill = document.getElementById('sanityFill');
            const percent = document.getElementById('sanityPercent');
            fill.style.width = gameState.sanity + '%';
            percent.textContent = Math.floor(gameState.sanity) + '%';
            
            fill.className = 'sanity-fill';
            document.body.classList.remove('low-sanity', 'critical-sanity');
            
            if (gameState.sanity < 50) {
                fill.classList.add('low');
                document.body.classList.add('low-sanity');
            }
            if (gameState.sanity < 25) {
                fill.classList.add('critical');
                document.body.classList.remove('low-sanity');
                document.body.classList.add('critical-sanity');
            }
        }

        function changeSanity(amount) {
            gameState.sanity = Math.max(0, Math.min(100, gameState.sanity + amount));
            updateSanity();

            if (amount < 0) {
                showBloodEffect();
                if (amount < -15) {
                    AudioManager.switchToSudden();
                }
            } else if (amount > 10) {
                AudioManager.switchToNormal();
            }
        }

        function changeBattery(amount) {
            gameState.battery = Math.max(0, Math.min(100, gameState.battery + amount));
            updateBattery();
        }

        function addItem(item) {
            if (!gameState.inventory.includes(item)) {
                gameState.inventory.push(item);
                updateInventory();
            }
        }

        function updateInventory() {
            const inv = document.getElementById('inventory');
            if (gameState.inventory.length > 0) {
                inv.classList.remove('hidden');
                inv.innerHTML = '<div class="inventory-label">ðŸ“¦ INVENTORY:</div>';
                gameState.inventory.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.textContent = item;
                    inv.appendChild(itemDiv);
                });
            } else {
                inv.classList.add('hidden');
            }
        }

        function updateTimestamp() {
            const hours = Math.floor(gameState.time / 3600);
            const minutes = Math.floor((gameState.time % 3600) / 60);
            const seconds = gameState.time % 60;
            document.getElementById('timestamp').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateCharacters() {
            const container = document.getElementById('characters');
            container.innerHTML = `
                <div class="character" id="char-you">
                    <div class="character-icon">ðŸ“¹</div>
                    <div class="character-name">YOU</div>
                    <div class="character-state">Investigator</div>
                </div>
            `;

            if (gameState.companions.grimlock) {
                const isDead = gameState.scene >= 6;
                container.innerHTML += `
                    <div class="character ${isDead ? 'dead' : ''}" id="char-grimlock">
                        <div class="character-icon">ðŸ§Œ</div>
                        <div class="character-name">GRIMLOCK</div>
                        <div class="character-state">The Troll</div>
                    </div>
                `;
            }

            if (gameState.companions.whiskers) {
                container.innerHTML += `
                    <div class="character" id="char-whiskers">
                        <div class="character-icon">ðŸ¦¦</div>
                        <div class="character-name">WHISKERS</div>
                        <div class="character-state">${gameState.scene >= 9 ? 'Brave Survivor' : 'Frightened Patient'}</div>
                    </div>
                `;
            }

            if (gameState.companions.mortis) {
                container.innerHTML += `
                    <div class="character" id="char-mortis">
                        <div class="character-icon">ðŸ’€</div>
                        <div class="character-name">MORTIS</div>
                        <div class="character-state">Dr. Mortimer's Assistant</div>
                    </div>
                `;
            }
        }

        // ============== EFFECTS ==============
        function showStatic() {
            const el = document.getElementById('staticEffect');
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 150);
        }

        function showBloodEffect() {
            const el = document.getElementById('bloodEffect');
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 600);
        }

        async function transitionScene() {
            const el = document.getElementById('sceneTransition');
            el.classList.add('active');
            await new Promise(r => setTimeout(r, 400));
            el.classList.remove('active');
        }

        // ============== SCENE MANAGEMENT ==============
        async function showScene(scene) {
            await transitionScene();
            
            const locationEl = document.getElementById('location');
            locationEl.textContent = scene.location || 'UNKNOWN LOCATION';
            locationEl.classList.toggle('danger', scene.danger || false);
            
            // Switch music based on scene danger level
            if (scene.danger) {
                AudioManager.switchToSudden();
            } else if (scene.calm) {
                AudioManager.switchToNormal();
            }
            
            const storyEl = document.getElementById('storyText');
            await typeWriter(storyEl, scene.text, 20);
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            scene.choices.forEach((choice, index) => {
                const btn = document.createElement('div');
                btn.className = 'choice';
                if (choice.class) btn.classList.add(choice.class);
                if (choice.disabled) btn.classList.add('disabled');
                
                let displayText = choice.text;
                if (choice.batteryReq && gameState.battery < choice.batteryReq) {
                    displayText += ` [BATTERY TOO LOW: ${choice.batteryReq}% REQUIRED]`;
                    btn.classList.add('disabled');
                }
                
                btn.textContent = displayText;
                btn.style.animationDelay = `${0.1 + index * 0.1}s`;
                
                btn.onclick = () => {
                    if (choice.disabled || (choice.batteryReq && gameState.battery < choice.batteryReq)) return;
                    
                    if (choice.action) {
                        showStatic();
                        choice.action();
                    }
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };
                choicesDiv.appendChild(btn);
            });

            updateCharacters();
        }

        // ============== BATTERY & TIME ==============
        function startBatteryDrain() {
            if (batteryInterval) clearInterval(batteryInterval);
            batteryInterval = setInterval(() => {
                if (gameState.battery > 0) {
                    gameState.battery -= gameState.batteryDrainRate;
                    if (gameState.battery < 0) gameState.battery = 0;
                    updateBattery();
                    
                    // Add emergency battery boost if player gets very low
                    if (gameState.battery <= 10 && Math.random() < 0.4) {
                        gameState.battery += 8;
                        if (gameState.battery > 100) gameState.battery = 100;
                        updateBattery();
                        typeText("Your night vision camera flickers and briefly recovers some power...", 800);
                    }
                    
                    if (gameState.battery <= 0) {
                        showScene({
                            location: "SYSTEM ERROR",
                            danger: true,
                            text: `Your night vision camera has died. In the pitch black darkness of Hollow Creek Asylum, you are defenseless. You hear something approaching... something that's been hunting you.

<div class="warning">BATTERY DEPLETED</div>
<div class="document">RECORDING TERMINATED</div>`,
                            choices: [
                                { text: "RESTART INVESTIGATION", action: () => restartGame(), class: "restart" }
                            ]
                        });
                        clearInterval(batteryInterval);
                        clearInterval(timeInterval);
                    }
                }
            }, 6000);  // Slower battery drain - every 6 seconds instead of 4
        }

        function startTime() {
            if (timeInterval) clearInterval(timeInterval);
            timeInterval = setInterval(() => {
                gameState.time++;
                updateTimestamp();
            }, 1000);
        }

        // ============== SCENES ==============
        const scenes = [
            // Scene 0: Opening
            {
                location: "LOCATION: ASYLUM MAIN GATE",
                calm: true,
                text: `The camera flickers on. Green phosphorescence floods your vision as night mode activates.

Hollow Creek Psychiatric Facility. The place where hope came to die.

Three years ago, your sister Emma vanished without a trace. The police gave up. Her case went cold. But you never stopped searching.

Then you found itâ€”a photograph hidden in her old apartment. On the back, stamped in faded ink: "Subject 47."

The trail led here. To this godforsaken place.

The iron gates hang open, rust bleeding down their bars like old wounds. Beyond them, the asylum waits in darkness.

You check your battery. Full charge. You take a breath.

Time to find the truth.

<div class="document">INVESTIGATION LOG: Entering Hollow Creek Facility. Time: 11:47 PM.</div>`,
                choices: [
                    { text: "Enter the asylum", action: () => goToScene(1) }
                ]
            },

            // Scene 1: Reception Hall
            {
                location: "LOCATION: RECEPTION HALL",
                text: `The reception hall is a graveyard of forgotten lives. Patient files carpet the floorâ€”hundreds of names, hundreds of stories, all abandoned.

A chandelier sways overhead, creaking in a wind that shouldn't exist indoors. The walls... God, the walls. Someone has carved symbols into them. Hundreds of them. The same pattern, over and over.

Your camera catches movement.

Two shapes emerge from the shadows. Your finger hovers over the power button, ready to run.

But then you see them clearly.

One stands nearly seven feet tallâ€”a hulking figure with grey-green skin and what looks like moss growing from his shoulders. A troll. An actual troll.

Beside him, something smaller. A meerkat standing upright, wearing the tattered remains of a hospital gown. Its eyes are too intelligent, too human.

The troll raises massive hands, palms out.

"Easy there, friend. We're not gonna hurt you." His voice is deep, like stones grinding together. "Name's Grimlock. This here's Whiskers."

The meerkat nods, whiskers twitching nervously.

"We used to be... well." Grimlock's face twists with something like grief. "We used to be like you."`,
                choices: [
                    { text: "Lower your camera and talk to them", action: () => { changeSanity(-5); goToScene(2); } },
                    { text: "Keep recording and ask what happened", action: () => goToScene(2) }
                ]
            },

            // Scene 2: The Bargain
            {
                location: "LOCATION: RECEPTION HALL",
                text: `<div class="document">RECORDING LOG: Subjects identified as "Grimlock" (Patient #089) and "Whiskers" (Patient #112). Genetic modification confirmed.</div>

Grimlock lowers himself to one knee, bringing his craggy face closer to your camera level.

"There was a doctor here. Mortimer. Said he was gonna cure us." He laughs bitterly. "Cure. That's what he called it. Turned us into monsters instead."

Whiskers steps forward, his voice refined and articulateâ€”jarringly human from such an inhuman form.

"We've been trapped in this nightmare for... honestly, I've lost count. Time moves strangely here. Days blur into weeks into months."

He glances toward a dark corridor, fear flickering across his features.

"There's something in the basement. Something worse than us. We hear it moving at night. Feeding."

Grimlock stands, his bulk blocking out what little light there is.

"Look, I'll be straight with you. There's a way outâ€”service exit in the east wing. But it's locked from a control room in the lower levels. We've tried to reach it alone. We... we can't."

He extends a massive hand.

"Help us escape this place, and we'll help you find whoever you're looking for. Deal?"

<div class="warning">CRITICAL DECISION: Choose your path forward.</div>`,
                choices: [
                    { 
                        text: "Accept their help - form an alliance", 
                        action: () => { 
                            gameState.companions.grimlock = true; 
                            gameState.companions.whiskers = true;
                            changeSanity(-10);
                            goToScene(3); 
                        } 
                    },
                    { 
                        text: "Go alone - you can't trust mutants", 
                        action: () => goToScene(2.5),
                        class: "dangerous"
                    }
                ]
            },

            // Scene 2.5: Going alone
            {
                location: "LOCATION: DARK CORRIDOR",
                danger: true,
                text: `<div class="warning">PROCEEDING WITHOUT ALLIES</div>

You step back from the outstretched hand.

"Sorry. I work alone."

Grimlock's arm drops. Something like hurt flashes across his inhuman face.

"Your funeral, friend."

Whiskers watches you go, his small form shrinking in your camera's viewfinder as you back away.

"Please reconsider," he calls out, voice echoing. "This place... it breaks people. Even the strong ones. Especially the strong ones."

You turn and walk into the darkness.

The corridor stretches ahead, impossibly long. Your footsteps echo. Something else echoes back.

Something that isn't your footsteps.

The walls feel closer now. You could swear they're moving. Breathing.

You're alone. Completely alone.

And something knows it.

<div class="warning">PSYCHOLOGICAL STRAIN INCREASING</div>`,
                choices: [
                    { text: "Continue forward alone", action: () => { changeSanity(-30); goToScene(2.6); }, class: "critical" },
                    { text: "Go back and accept their help", action: () => { gameState.companions.grimlock = true; gameState.companions.whiskers = true; goToScene(3); } }
                ]
            },

            // Scene 2.6: Alone bad ending
            {
                location: "LOCATION: UNKNOWN",
                danger: true,
                text: `The camera shakes. Your breathing comes in ragged gasps.

You don't know how long you've been walking. Hours? Days? The corridors all look the same. Every door leads to another hallway. Every hallway leads to another door.

You start hearing Emma's voice.

"Over here... I'm over here..."

You follow it. Of course you follow it. She needs you.

But the voice keeps moving. Always just around the next corner. Always just out of reach.

Your camera flickers. Battery's dying. When did that happen?

Then you hear something else. Something real.

Wet. Heavy. Close.

The camera falls from your hands as something massive wraps around your legs. The last frame shows the ceilingâ€”cracked tiles, exposed pipes, a hundred patient faces carved into the concrete, all of them screaming.

The last thing recorded is not a scream.

It's silence.

<div class="warning">INVESTIGATION TERMINATED</div>
<div class="document">SUBJECT 47: STATUS UNKNOWN<br>INVESTIGATOR: MISSING - PRESUMED DECEASED</div>`,
                choices: [
                    { text: "RESTART INVESTIGATION", action: () => restartGame(), class: "restart" }
                ]
            },

            // Scene 3: Doctor's Office
            {
                location: "LOCATION: DR. MORTIMER'S OFFICE",
                text: `Together, you move deeper into the asylum.

Grimlock takes point, his massive shoulders forcing open doors that have been sealed for years. Whiskers navigates from memory, guiding you through service corridors and forgotten passageways.

You reach a door marked "DR. M. MORTIMER - RESEARCH DIRECTOR."

Inside, the office is frozen in time. Books on genetic engineering. Anatomy charts showing things that shouldn't exist. A desk covered in handwritten notes.

Whiskers finds a leather-bound journal. His paws tremble as he reads.

"Subject 47. Female. Age 26. Cognitive patterns show exceptional compatibility with Entity synchronization. Recommend immediate advancement to Phase 3 protocols..."

His voice trails off. He turns the page and goes still.

"What is it?" you ask.

Wordlessly, he shows you.

A photograph. Paper-clipped to the journal entry.

Your sister's face stares back at you. Emma. Smiling in what looks like an intake photo. Below it, stamped in red: SUBJECT 47 - PRIORITY ASSET.

The camera shakes in your hands.

Grimlock's voice is quiet. Gentle.

"The basement. That's where Mortimer kept the ones he considered... special." He pauses. "That's also where the thing lives. The one we told you about."

<div class="warning">EMOTIONAL TRAUMA DETECTED - MAINTAIN FOCUS</div>`,
                choices: [
                    { text: "Search the office for more clues", action: () => { addItem("DR. MORTIMER'S JOURNAL"); addItem("EMMA'S PHOTO"); changeBattery(15); changeSanity(-10); goToScene(4); } },
                    { text: "Go to the basement immediately", action: () => { addItem("EMMA'S PHOTO"); changeSanity(-15); goToScene(4); }, class: "dangerous" }
                ]
            },

            // Scene 4: Basement Descent
            {
                location: "LOCATION: BASEMENT STAIRWELL",
                danger: true,
                text: `The stairs descend into absolute darkness.

Your camera struggles to pierce it. Even with night vision cranked to maximum, you can barely see ten feet ahead. The air down here is differentâ€”thick and wet, heavy with the smell of stagnant water and something else.

Something organic. Something alive.

Grimlock squeezes through the narrow stairwell, stone scraping against stone.

"Stay close," he rumbles. "And stay quiet."

Whiskers moves beside you, his whiskers twitching constantly, reading the air.

"There's something you should know," he whispers. "About the creature down here."

You keep the camera rolling.

"Mortimer called it Project Ouroboros. His masterpiece, he said. He took patientsâ€”dozens of themâ€”and he... merged them. With something. Something old. Something that was already here when the asylum was built."

The corridor opens into a vast underground chamber. Water covers the floor, black and still as glass.

Something moves beneath the surface. Something enormous.

A sound fills the chamber. Low. Resonant. Hungry.

Hissing.

<div class="warning">HOSTILE ENTITY DETECTED - EXTREME CAUTION ADVISED</div>`,
                choices: [
                    { 
                        text: "Let Grimlock scout ahead while you prepare", 
                        action: () => { changeSanity(-15); goToScene(5); }
                    },
                    { 
                        text: "Use your camera's high-intensity light to scan the area",
                        action: () => { changeBattery(-15); changeSanity(-10); goToScene(5); },
                        class: "dangerous",
                        batteryReq: 10
                    }
                ]
            },

            // Scene 5: The Anaconda
            {
                location: "LOCATION: FLOODED CHAMBER",
                danger: true,
                text: `<div class="warning">!!! EXTREME DANGER !!!</div>

It comes from above.

No warning. No sound. Just thirty feet of nightmare dropping from the darkness like the wrath of a dead god.

The creature defies description. Your camera tries to capture itâ€”scales the color of bruised flesh, a body thick as an oak tree, coils that seem to go on forever. But it's the faces that break something inside you.

Human faces. Pressed against the inside of its skin. Dozens of them. Mouths open in eternal, silent screams.

This is what Mortimer created. This is Project Ouroboros.

It strikes.

Grimlock moves faster than anything his size should be able to. He throws you aside like you weigh nothing. The impact saves your life.

The coils find him instead.

You hear bones breaking. Grimlock's roar of pain becomes a roar of defiance.

"GO!" he bellows, his voice cracking. Blood runs from his mouth. "FIND YOUR SISTER! TELL THEM WHAT HAPPENED HERE!"

Whiskers grabs your arm with surprising strength, dragging you toward a side tunnel.

"We have to move. NOW."

The last thing your camera captures: Grimlock's eyes, locked on the lens. Not afraid. Not angry.

Proud.

Then the coils tighten, and he's gone.

<div class="warning">COMPANION LOST: GRIMLOCK - KILLED IN ACTION</div>`,
                choices: [
                    { text: "Flee into the tunnels with Whiskers", action: () => { gameState.companions.grimlock = false; changeSanity(-25); goToScene(6); }, class: "critical" }
                ]
            },

            // Scene 6: Separated
            {
                location: "LOCATION: UNKNOWN TUNNELS",
                text: `Run. Don't think. Just run.

The tunnels twist and branch and double back. Whiskers is somewhere behind youâ€”or ahead of youâ€”his panicked chittering echoing off the walls.

Then your camera dies.

Total darkness. The kind that presses against your eyes like a physical weight.

You stand there, breathing hard, listening to your own heartbeat thunder in your ears.

After an eternity, the camera flickers back to life.

You're alone.

No Grimlock. His sacrifice bought you time. Bought you survival.

No Whiskers. Lost somewhere in the maze.

Just you. Your camera. And whatever battery you have left.

You could break down. You could curl up in the darkness and wait for the end.

But Emma is still down here. Somewhere.

You keep moving.

The tunnel opens into a chamber, and you realize you've found something. Equipment. Medical machinery. Tanks filled with murky fluid.

Mortimer's real laboratory. Hidden beneath the asylum itself.

<div class="document">RECORDING CONTINUES: Investigator alone. Psychological stress elevated. Proceeding with mission.</div>`,
                choices: [
                    { text: "Explore the laboratory", action: () => { changeSanity(-10); goToScene(7); } },
                    { text: "Search for Whiskers first", action: () => { changeBattery(-10); goToScene(7); } }
                ]
            },

            // Scene 7: The Laboratory
            {
                location: "LOCATION: LABORATORY OF HORRORS",
                calm: true,
                text: `The laboratory stretches before you like a cathedral built by madmen.

Glass cylinders line the walls. Inside them float... things. Failed experiments. Bodies twisted into shapes that couldn't survive. Faces frozen mid-scream.

At the center of it all stands a chair. Medical restraints. Neural interface helmet. Needles and wires and tubes feeding into machinery that hums with power even now.

This is where it happened. This is where Mortimer played god.

"You made it."

You spin, camera raised like a weapon.

Whiskers steps from the shadows. But something's different about him. He stands straighter. His eyes are clear. Calm.

Behind him walks a figure that stops your heart.

A skeleton. Wearing a pristine lab coat. Carrying an old lantern that flickers with pale light.

"Don't be afraid," Whiskers says. "This is Mortis. He was Mortimer's assistant. He tried to stop the experiments. Mortimer... punished him for it."

The skeleton inclines its skull in greeting. When it speaks, the voice seems to come from everywhere and nowhere.

"I've been waiting for someone like you. Someone who could end this."

Whiskers steps forward.

"Grimlock died so we could reach this place. His courage... it showed me something. I spent so long being afraid. Running. Hiding." His small hands clench into fists. "No more."

<div class="document">ALLIES REJOINED - BATTERY CACHE LOCATED (+30%)</div>`,
                choices: [
                    { text: "Listen to Mortis's story", action: () => { changeBattery(30); gameState.companions.whiskers = true; gameState.companions.mortis = true; changeSanity(10); goToScene(8); } }
                ]
            },

            // Scene 8: The Truth
            {
                location: "LOCATION: MORTIMER'S LABORATORY",
                text: `Mortis moves to an old console, skeletal fingers dancing across controls that somehow still respond.

"I need to show you something. You need to understand what you're walking into."

Screens flicker to life. Footage. Old recordings.

"I came here as a student. Idealistic. Naive. Mortimer seemed like a visionaryâ€”pushing the boundaries of human potential."

The footage shows experiments. Patients. Procedures.

"But he found something beneath the asylum. Something that had been sleeping for centuries. An entity that feeds on consciousness. On souls. On the very essence of what makes us human."

Mortis turns to face you. Empty eye sockets somehow convey infinite sadness.

"I tried to stop him. Sabotaged equipment. Freed patients. He caught me." The skeleton gestures at its own form. "This is my punishment. Awareness without flesh. Existence without life."

Whiskers speaks up, his voice steady with newfound resolve.

"Your sisterâ€”Emmaâ€”was supposed to be the final piece. Her mind had some quality Mortimer needed. He planned to fuse himself with the entity, using her consciousness as a bridge."

"But something went wrong," Mortis continues. "The process stalled. She's still in there. Still connected to the entity. Alive, but trapped."

He points to a massive sealed door at the far end of the laboratory.

"Beyond that door lies the entity. And your sister."

<div class="warning">FINAL CONFRONTATION IMMINENT</div>`,
                choices: [
                    { 
                        text: "Prepare to face the entity",
                        action: () => { addItem("FREQUENCY DISRUPTOR"); changeSanity(-20); goToScene(9); },
                        class: "critical"
                    },
                    { 
                        text: "Search for more batteries first", 
                        action: () => { addItem("FREQUENCY DISRUPTOR"); changeBattery(20); goToScene(9); }
                    }
                ]
            },

            // Scene 9: The Entity Chamber
            {
                location: "LOCATION: THE ENTITY'S DOMAIN",
                danger: true,
                text: `<div class="warning">!!! POINT OF NO RETURN !!!</div>

The door opens.

Your camera can't process what lies beyond. The image warps, distorts, tries to make sense of geometry that shouldn't exist.

The chamber is alive. Walls of pulsing flesh. Veins of bioluminescent light threading through tissue that breathes. And at the center...

God. At the center.

A mass of merged consciousness. Hundreds of minds, hundreds of souls, twisted into a single writhing form. You see faces in that horrorâ€”patients, doctors, guardsâ€”all absorbed. All screaming.

And there. In the heart of it.

Emma.

Her face is visible in the mass. Eyes closed. But alive. You can see her chest rising and falling.

Mortis presses a device into your hands. Cold metal. Blinking lights.

"A frequency disruptor. It will destabilize the entity's cohesion. Break the bonds holding those souls together." His voice cracks with something like hope. "But someone has to get close. Someone has to activate it at the core."

Whiskers steps forward before you can speak.

"I'll do it."

"Whiskersâ€”"

"No." He turns to face you. This small creature. This terrified meerkat who'd spent years hiding from shadows. "Grimlock died for us. Mortis has been waiting decades for someone to end this. And youâ€”you came here for your sister. You need to be the one to bring her home."

His whiskers twitch. Something like a smile crosses his face.

"Let me be brave. Just this once."`,
                choices: [
                    { 
                        text: "Let Whiskers approach with the disruptor while you record",
                        action: () => { changeBattery(-20); changeSanity(-20); goToScene(10); },
                        class: "critical",
                        batteryReq: 15
                    },
                    { 
                        text: "You approach yourself - Whiskers has suffered enough",
                        action: () => { changeBattery(-25); changeSanity(-30); goToScene(10.5); },
                        class: "critical",
                        batteryReq: 18
                    }
                ]
            },

            // Scene 10: The Disruption
            {
                location: "LOCATION: ENTITY CHAMBER - CRITICAL EVENT",
                danger: true,
                text: `Everything happens at once.

Whiskers tears across the chamber, weaving between tendrils that erupt from the floor. He's fastâ€”faster than the entity can track.

You and Mortis work the control console. Mortis's skeletal fingers fly across keys, rerouting power, priming the extraction matrix.

"THERE!" Mortis shouts. "She's separating! The disruptor is working!"

The entity screams.

Not a soundâ€”a feeling. Every soul it consumed, crying out at once. Your camera's audio clips. Visual static tears across the frame.

But you keep recording. You have to keep recording.

Whiskers reaches the core. He slams the disruptor against the central mass and hits the activation switch.

Light. Blinding, even through the camera.

When it fades, the entity is coming apart. Streams of lightâ€”freed soulsâ€”spiral toward the ceiling and vanish. Decades of prisoners, finally released.

Mortis works the console frantically.

"I've got her! Subject 47 is separating from the collective!"

On the screen, you see it. Emma's consciousness, pulling free from the nightmare. Whole. Intact.

Saved.

Whiskers lies at the base of the entity, the disruptor clutched in his small hands. He's not moving.

But he's breathing.

<div class="document">EXTRACTION SUCCESSFUL: SUBJECT 47 RECOVERED</div>
<div class="document">ENTITY STATUS: DESTABILIZING</div>`,
                choices: [
                    { text: "Complete the transfer and escape", action: () => { changeSanity(20); goToScene(11); }, class: "critical" }
                ]
            },

            // Scene 10.5: Your sacrifice
            {
                location: "LOCATION: ENTITY CHAMBER - ALTERNATE PATH",
                danger: true,
                text: `"No."

The word leaves your mouth before you realize you've spoken.

"Whiskers, you've suffered enough. All of you have." You take the disruptor from Mortis. "This is my sister. My fight. My risk."

Whiskers tries to protest, but you're already moving.

The entity senses you coming. Tendrils whip toward youâ€”you dodge one, duck another, feel a third graze your shoulder hard enough to draw blood.

But you keep moving.

Emma's face is right there. So close.

"I'm here," you whisper. "I'm here, Emma. I found you."

You slam the disruptor against the entity's core and activate it.

The world explodes into white.

For a momentâ€”an eternityâ€”you're inside the entity. You feel everything it feels. Every absorbed soul. Every year of agony. Grimlock's last thoughts of hope. The patients who never gave up.

And Emma. Reaching out to you through the chaos.

Then hands are pulling you back. Whiskers and Mortis, dragging you free as the entity collapses in on itself.

You fall to the ground, gasping. But in your hand, you feel something warm.

Emma's consciousness, safely extracted. Saved.

<div class="document">EXTRACTION SUCCESSFUL: SUBJECT 47 RECOVERED</div>
<div class="document">INVESTIGATOR STATUS: INJURED BUT STABLE</div>`,
                choices: [
                    { text: "Escape the collapsing asylum", action: () => { changeSanity(-10); goToScene(11); }, class: "critical" }
                ]
            },

            // Scene 11: The Escape
            {
                location: "LOCATION: ASYLUM COLLAPSE",
                danger: true,
                text: `<div class="warning">STRUCTURAL FAILURE IMMINENT</div>

The asylum is dying.

Without the entity to sustain it, decades of impossible architecture begin to fail. Walls crack. Ceilings buckle. The ground itself seems to groan in relief.

Mortis's skeletal form begins to glow from within.

"My time is done." His voice is peaceful now. Free of the pain that had defined his existence. "The souls are released. My purpose is fulfilled."

"Mortisâ€”"

"Go. Take your sister. Take Whiskers. Live the life that was stolen from us."

He raises one skeletal hand in farewell. Then the light consumes him, and he's gone.

Whiskers grabs your hand.

"We need to MOVE."

You run. Through collapsing corridors. Past the remains of Project Ouroboros, dissolving into nothing. Up stairs that crumble behind you.

The exit appearsâ€”a door you've never seen, blown open by the structural chaos.

You burst through into cold night air just as Hollow Creek Asylum collapses behind you in a thunderous roar of dust and stone and finallyâ€”finallyâ€”silence.

You're outside.

You're alive.

In your arms, you hold Emma's consciousness, safe in the extraction matrix. She can be restored. She WILL be restored.

And beside you stands Whiskers. No longer a victim. A survivor. A hero.

<div class="document">INVESTIGATION COMPLETE | SUBJECT 47: RECOVERED | HOLLOW CREEK: DESTROYED</div>`,
                choices: [
                    { text: "Turn off the camera and look to the future", action: () => goToScene(12) }
                ]
            },

            // Scene 12: Epilogue
            {
                location: "[RECORDING STOPPED]",
                calm: true,
                text: `Dawn breaks over the ruins.

The first light in years to touch this ground without the asylum's shadow.

You sit in the grass, the extraction matrix cradled in your lap like the precious thing it is. Whiskers sits beside you, watching the sunrise with eyes that have seen too much darkness.

Sirens in the distance. Emergency services, responding to the seismic activity.

Let them come. Let them find the ruins. Let them discover what happened here.

You have the footage. Every second of horror. Every crime. Every victim.

The world will know.

Whiskers speaks first.

"What happens now? To me, I mean."

You look at this small creature who crossed through hell at your side. Who found courage when it mattered most.

"You come with me." You manage something like a smile. "Emma's going to need time to recover. She'll need people around her who understand what she went through. Who can help her heal."

"And you trust me? A monster?"

"You're not a monster, Whiskers." You reach out and rest a hand on his shoulder. "You're a hero. Grimlock knew it. Mortis knew it. Now I know it too."

The meerkat's eyes glisten. He nods.

Together, you walk toward the rising sun.

<div style="text-align: center; margin-top: 30px; font-size: 1.3em; color: #0ff;">
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
[INVESTIGATION COMPLETE]<br>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br><br>
ðŸ“¹ Recording Time: ${Math.floor(gameState.time / 60)} min<br>
ðŸ”‹ Final Battery: ${Math.floor(gameState.battery)}%<br>
ðŸ§  Final Sanity: ${Math.floor(gameState.sanity)}%<br>
ðŸ’€ Allies Lost: 1 (Grimlock)<br>
âœ¨ Allies Saved: 1 (Whiskers)<br>
â¤ï¸ Sister: RECOVERED<br>
ðŸ† Mission: SUCCESS
</div>`,
                choices: [
                    { text: "VIEW FINAL REPORT", action: () => goToScene(13) },
                    { text: "START NEW INVESTIGATION", action: () => restartGame(), class: "restart" }
                ]
            },

            // Scene 13: Six Months Later
            {
                location: "SIX MONTHS LATER - NEWS ARCHIVE",
                calm: true,
                text: `<div class="document">BREAKING NEWS REPORT</div>

The anchor's voice fills the screen:

"Tonight, we bring you the conclusion of what authorities are calling the most disturbing case of medical malpractice in modern history.

Hollow Creek Psychiatric Facility, once a respected treatment center, has been revealed as the site of decades of illegal human experimentation. Dr. Marcus Mortimer, who disappeared three years ago, has been posthumously charged with over two hundred counts of unlawful genetic modification, involuntary confinement, and murder.

The evidence came from an unlikely sourceâ€”video footage captured by an anonymous investigator who entered the facility searching for a missing relative.

Emma Rodriguez, classified as 'Subject 47' in Mortimer's files, has been successfully recovered through experimental consciousness transfer technology. Medical experts describe her recovery as 'miraculous.'

Perhaps most remarkably, one of Mortimer's victimsâ€”a genetically modified individual known only as 'Whiskers'â€”has become a public advocate for survivors' rights.

And tonight, we remember those who didn't survive. Including one known only as 'Grimlock,' who witnesses say sacrificed himself to save others during the facility's collapse."

The segment ends. The screen fades to black.

Justice, finally.

<div class="document">CASE STATUS: CLOSED | VICTIMS: IDENTIFIED | FACILITY: DEMOLISHED</div>`,
                choices: [
                    { text: "Continue to final chapter", action: () => goToScene(14) }
                ]
            },

            // Scene 14: One Year Later
            {
                location: "ONE YEAR LATER - YOUR APARTMENT",
                calm: true,
                text: `The footage plays on your monitor for the last time.

Green-tinted corridors. Grimlock's face. The entity's death throes. Emma, emerging from the nightmare.

You close the file. Archive it. Password-protected. Encrypted. Safe.

From the kitchen, you hear Emma singing softly as she makes coffee. She does that nowâ€”sings. Something she'd stopped doing years before she disappeared. The doctors say the mind heals in its own time. Hers chose music.

A knock at the door.

Whiskers lets himself in, a bakery bag tucked under one arm. He's changed tooâ€”dresses in tailored suits now, speaks at conferences, fights for the rights of people like him. The media calls him an inspiration. He calls himself lucky.

"Brought breakfast," he announces, setting the bag on the counter. "Those chocolate croissants Emma likes."

Emma's face lights up. She hugs himâ€”this strange, small creature who walked through hell with her brother.

You watch them together. Your sister, alive. Your friend, at peace.

The camera sits on a shelf now, gathering dust. You'll never forget what it recorded. But you've made peace with it.

Some nightmares end.

Some stories get happy endings.

This one does.

<div style="text-align: center; margin-top: 30px; font-size: 1.4em; color: #0f0;">
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
[END OF RECORDING]<br>
[THE END]<br>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
</div>`,
                choices: [
                    { text: "ROLL CREDITS", action: () => goToScene(15) },
                    { text: "START NEW INVESTIGATION", action: () => restartGame(), class: "restart" }
                ]
            },

            // Scene 15: Credits
            {
                location: "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
                calm: true,
                text: `<div style="text-align: center; line-height: 2.2;">

<div style="font-size: 2.2em; color: #0f0; text-shadow: 0 0 20px #0f0; margin-bottom: 20px;">
HOLLOW CREEK ASYLUM
</div>
<div style="color: #0a0; margin-bottom: 25px;">
[THE NIGHT VISION FILES]
</div>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
<span style="color: #ff0;">ðŸŽ‚ SPECIAL DEDICATION ðŸŽ‚</span><br>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br><br>

<div style="background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,0,255,0.2)); padding: 20px; border-radius: 15px; border: 2px solid #ff0; margin: 20px 0;">
<span style="font-size: 1.8em; color: #ff0;">ðŸŽ‰ HAPPY BIRTHDAY VC! ðŸŽ‰</span><br><br>
<span style="color: #fff; font-size: 1.1em;">May your year be filled with<br>adventure, joy, and all the<br>happiness you deserve!</span><br><br>
<span style="font-size: 2em;">ðŸŽˆðŸŽðŸŽŠðŸŒŸðŸŽˆ</span><br><br>
<span style="color: #0ff;">This game is dedicated to you,<br>on your special day!</span>
</div>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
<span style="color: #0ff;">CREATED BY</span><br>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br><br>

Game Concept & Story<br>
<span style="color: #0f0;">YOUR ORIGINAL VISION</span><br><br>

Inspired By<br>
<span style="color: #0f0;">OUTLAST (RED BARRELS)</span><br><br>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
<span style="color: #0ff;">MAIN CHARACTERS</span><br>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br><br>

ðŸ“¹ The Investigator - YOU<br>
ðŸ‘© Subject 47 / Emma - YOUR SISTER<br>
ðŸ§Œ Patient #089 / Grimlock - <span style="color: #f00;">HERO</span><br>
ðŸ¦¦ Patient #112 / Whiskers - SURVIVOR<br>
ðŸ’€ Mortis - REDEEMED<br><br>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
<span style="color: #0ff;">YOUR STATS</span><br>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br><br>

Recording Time: ${Math.floor(gameState.time / 60)} min<br>
Battery Used: ${100 - Math.floor(gameState.battery)}%<br>
Sanity Lost: ${100 - Math.floor(gameState.sanity)}%<br>
Documents Found: ${gameState.inventory.length}<br><br>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
<span style="color: #0ff;">IN MEMORY OF</span><br>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br><br>

<span style="color: #0f0; font-size: 1.2em;">GRIMLOCK</span><br>
<span style="font-style: italic; color: #0a0;">
"Some heroes aren't born.<br>They're made in the moment<br>that matters most."
</span><br><br>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br><br>

<span style="font-size: 1.1em; color: #0ff;">
Thank you for playing<br>
HOLLOW CREEK ASYLUM
</span><br><br>

<span style="color: #ff0;">And once again...<br>HAPPY BIRTHDAY VC! ðŸŽ‚</span>

</div>`,
                choices: [
                    { text: "RETURN TO MAIN MENU", action: () => restartGame(), class: "restart" }
                ]
            }
        ];

        function goToScene(sceneNum) {
            // Handle decimal scene numbers for branching
            const sceneIndex = Math.floor(sceneNum);
            const isAltScene = sceneNum !== sceneIndex;
            
            let scene;
            if (isAltScene) {
                // Map decimal scenes
                if (sceneNum === 2.5) scene = scenes[3];
                else if (sceneNum === 2.6) scene = scenes[4];
                else if (sceneNum === 10.5) scene = scenes[11];
                else scene = scenes[sceneIndex];
            } else {
                // Adjust for branch scenes offset
                if (sceneNum <= 2) scene = scenes[sceneNum];
                else if (sceneNum >= 3) scene = scenes[sceneNum + 2]; // Skip 2.5 and 2.6
            }
            
            gameState.scene = sceneNum;
            showScene(scene);
        }

        function restartGame() {
            gameState.scene = 0;
            gameState.battery = 100;
            gameState.sanity = 100;
            gameState.inventory = [];
            gameState.companions = { grimlock: false, whiskers: false, mortis: false };
            gameState.time = 0;
            
            document.body.classList.remove('low-sanity', 'critical-sanity');
            
            updateBattery();
            updateSanity();
            updateInventory();
            
            AudioManager.switchToNormal();
            
            goToScene(0);
            startBatteryDrain();
            startTime();
        }

        // ============== INITIALIZATION ==============
        window.addEventListener('load', () => {
            AudioManager.init();
            
            // Click anywhere to skip typewriter
            document.addEventListener('click', (e) => {
                if (gameState.isTyping && !e.target.classList.contains('choice') && !e.target.classList.contains('audio-btn')) {
                    skipTypewriter();
                }
            });
            
            // Start game after loading
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                AudioManager.playBgMusic();
                goToScene(0);
                startBatteryDrain();
                startTime();
            }, 2800);
        });
    </script>
</body>
</html>
